<style>
page {
  width: 750rpx;
}

/* banner */
.swiper {
  width: 100%;
  height: 324rpx;
}

.swiper image {
  width: 100%;
  height: 100%;
  display: block;
}

.swiper swiper-item {
  display: block;
  width: 100%;
  height: 100%;
}

/* 页面 */
.search_box {
  width: 100%;
  height: 110rpx;
  background: #c1e2de;
  justify-content: center;
}

.search_box input {
  background: #fff;
  width: 602rpx;
  height: 82rpx;
  border-radius: 10rpx 0 0 10rpx;
  padding: 0 20rpx;
  font-size: 30rpx;
}

.search_box .search_btn {
  width: 92rpx;
  height: 82rpx;
  background: #17392f;
  border-radius: 0 10rpx 10rpx 0;
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAA0CAMAAAD/uJueAAAArlBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8tivQqAAAAOXRSTlMA9Pz5DQc3IwTrewronXVuVD8nEe/k3NbJtJFCOzEVqJdiGdrOwoxNSOCsomhYLR7SsaWBUbiEXL2HyJlUAAACqElEQVRIx5WV56KiMBCFCVUEEVCvNBWxgL2XvP+L7Qh7Y0iAZc8vSPJlZsiZIDCSj2G2t16248odoYVkp78diTjXeNedyP8E7lcT0xrPMqORiGYoXzjceN55o+fPZjxpIPojDJJ6/VTVtGOUdbf5gHdQaoBBIOWAqnyHwuDnE/RZzcg7mBR9tZy6om4l2GddyayB0C2Z38pCsFW3wxNzmDAPVXt19jrEmXPjGuSMyDCjPWw3Zr+b8Ukr5oNP7EMKa29wtgEz5Qwx/jmxwDRYiBJarN2Oj/EmKqf7CXJnicTHhTxXhXJ6nVJ8qMQ32HPaEdv4CTyPj6X6YDhlgzgiQcQsRBjP6byeUInLIl381e60hMwUKgUf3tm8jAuFeIMexivq+7jgvi4bRJnRPTCAmLr6nVUha0toSmymvESMQgqBwT2HqFSzZcIdYSksR+HNogSEgMJTHrEETqceKojtVBAOEpYytnxecv9top+HJReVoYhyxgoKrLxKFMc+Fj6JoTdUagLeF1rz1ePDuST0PQGesJlFvNXXJVuOoEamW/hDerFXBXIaiCNY3ZuWhmwEDp/WI1cIcmP6D6qT+vV3ooTxmW3aFNpuZNfVvoG8D9xVOfv4Na0kJkuYexj8+BlDnLnBE/dx7uWKSqP89o3ZE9WeQ2I0TmG+28qiOzqxlpSd6/4u0jLuu1OYHmjOzRMxkRjIVc4tfnlosXhfVuONXgCEsaoM4sZmeRkeXrokt+qTU9Tb2ZTI+mVwh+7Sf9/1mpPTIiu+vD3vcQ3s098fCWEyoU7GIBnIyvc2JXE3odBST1Lb4tgSMQLCrLSWjHwlzCNpySQXwlynLRltRZi10ZJxl+S4mnqe93ouW2ir8NcGqdBatpkTcE221/zDnCPhP9RRX70bxPgD4OeMaXPh4WAAAAAASUVORK5CYII=");
  background-size: 50rpx 52rpx;
  background-position: center center;
  background-repeat: no-repeat;
}

.product_row {
  width: 750rpx;
  height: 402rpx;
  background: #17392f;
  margin-top: 20rpx;
  padding: 20rpx;
  overflow: hidden;
  box-sizing: border-box;
}

.product_row .item {
  width: 224rpx;
  background: #fff;
  border-radius: 10rpx;
  overflow: hidden;
  flex-shrink: 0;
  border: 1px solid #fff;
}

.product_row scroll-view {
  height: 200rpx;
  width: 710rpx;
}

.product_row .item image {
  display: block;
  width: 230rpx;
  height: 142rpx;
}

.product_in {
  display: flex;
  width: 100%;
  justify-content: space-between;
}

.product_row .item text {
  display: block;
  padding: 8rpx;
  font-size: 18rpx;
  text-align: center;
}

.herbplantist {
  display: flex;
  justify-content: flex-end;
  width: 713rpx;
  height: 70rpx;
  position: relative;
  right: 0;
  transform: translateX(10px);
}

.discribe {
  text-align: right;
  position: relative;
  color: #fff;
  width: 730rpx;
  overflow: hidden;
}

.discribe text {
  font-size: 18rpx;
}

.discribe .play_time {
  font-size: 62rpx;
  font-weight: bold;
  line-height: 1;
}

/* 商品列表 */

.product_list {
  background: url("https://qncdn.playonwechat.com/hepulanShop/index_product_bg.png");
  background-size: 750rpx 387rpx;
  background-position: 0 0;
  min-height: 387rpx;
  background-color: #c1e2de;
  padding-top: 162rpx;
  padding-bottom: 100rpx;
  background-repeat: no-repeat;
}

.productNav {
  justify-content: center;
  margin-bottom: 30rpx;
}

.productNav .nav_item {
  width: 158rpx;
  height: 56rpx;
  text-align: center;
  line-height: 56rpx;
  background: #fff;
  color: #17392f;
}

.productNav .nav_item:nth-of-type(1) {
  border-radius: 4rpx 0 0 4rpx;
}

.productNav .nav_item:nth-of-type(2) {
  border-radius: 0 4rpx 4rpx 0;
}

.item_product {
  width: 704rpx;
  height: 220rpx;
  background-size: 100% 100%;
  margin: 15rpx auto;
  line-height: 50rpx;
  text-align: center;
  color: #fff;
  flex-direction: column;
  justify-content: center;
}

.item_product view:nth-of-type(1) {
  font-size: 36rpx;
}

.item_product view:nth-of-type(2) {
  font-size: 26rpx;
}

.item_product .buy {
  width: 168rpx;
  height: 34rpx;
  background: #fff;
  color: #333;
  line-height: 34rpx;
  text-align: center;
  font-size: 20rpx;
}

.item_product .buy::after {
  display: none;
}
</style>

<template>
    <view class="container">
        <!-- 搜索 -->
        <view class="search_box flex">
            <input type="text" confirm-type="search" bindconfirm="searchSubmit" />
            <view class="search_btn"></view>
        </view>
        <!-- 轮播 -->
        <swiper class="swiper" indicator-dots="true" 
            autoplay="true" 
            interval="5000" 
            duration="1000">    
        <repeat wx:for="{{imgUrls}}" wx:key="index">
            <swiper-item>
                <image src="{{item.image}}" class="slide-image"/>
            </swiper-item>
        </repeat>
    </swiper>

        <!-- 商品列表 -->
        <navigator class="product_row" url="../fightGroup/fightGroup">
            <scroll-view scroll-x="true">
                <view class="product_in">
                    <view class="item" wx:for="{{productRow}}" wx:key="index">
                        <image src="{{item.logo}}"></image>
                        <text>{{item.name}}</text>
                    </view>
                </view>
            </scroll-view>
            <view class="discribe">
                <image class="herbplantist" src="https://qncdn.playonwechat.com/hepulanShop/index_herbplantist.png"></image>
                <text>新品拼团剩余时间</text>
                <view class="play_time">{{pageTime}}</view>
            </view>
        </navigator>
        <!-- 女人街  -->
        <repeat wx:for="{{productList}}">
           <view class="product_list">
            <view class="productNav flex">
                <view class="nav_item" @tap="changeNav({{index}})" wx:for="{{productNav}}" wx:key="index" style="background:{{item.active?'#17392f':''}};color:{{item.active?'#fff':''}}">{{item.text}}</view>
            </view>
            <!-- 商品 -->
            <view class="item_product flex" wx:for="{{item.goods}}" wx:for-item="goods" wx:key="index" style="background-image:url({{goods.logo}})">
                <view>{{goods.name}}</view>
                <view>￥{{goods.price/100}}</view>
                <button class="buy">立即购买</button>
            </view>
        </view>
        </repeat>
        
    </view>
</template>

<script>
import wepy from "wepy";
import Swiper from "../../components/swiper";
import comm from "../../comm/comm";
import tip from "../../comm/tip";

import wxRequest from "../../comm/wxRequest";
import api from "../../api/api";
export default class extends wepy.page {
  config = {
    navigationBarTitleText: "禾葡兰护肤商城",
    navigationBarBackgroundColor: "#16382e",
    navigationBarTextStyle: "#fff"
  };

  data = {
    productRow: [],
    productNav: [
      {
        text: "最热",
        active: true
      },
      {
        text: "最新",
        active: false
      }
    ],
    productList: [
      {
        img: "http://iph.href.lu/704x220",
        name: "倾慕丰润口红",
        price: "380"
      },
      {
        img: "http://iph.href.lu/704x220",
        name: "倾慕丰润口红",
        price: "380"
      },
      {
        img: "http://iph.href.lu/704x220",
        name: "倾慕丰润口红",
        price: "380"
      }
    ],
    pageTime: "00:00:00",
    imgUrls: []
  };

  methods = {
    changeNav(e) {
      let productNav = this.productNav;
      for (var i = 0; i < productNav.length; i++) {
        productNav[i].active = false;
      }
      productNav[e].active = true;
      this.productNav = productNav;
      console.log(this);
      this.$apply();
    },
    searchSubmit() {
      console.log("搜索了");
    }
  };

  onShow() {
    console.log("show index");
    let that = this;
    let imgUrls = this.imgUrls;
    comm.wxRequest({ query: {} }, api.Home, function(res) {
      // console.log(res);
      let imgUrls = res.data.data.banner;
      let productRow = res.data.data.group;
      let productList = res.data.data.sellGoods;
      for (let i = 0; i < imgUrls.length; i++) {
        imgUrls[i].image = `${res.data.data.domain}${imgUrls[i].image}`;
      }
      for (let i = 0; i < productRow.length; i++) {
        productRow[i].logo = `${res.data.data.domain}${productRow[i].logo}`;
      }
      for (let i = 0; i < productList.length; i++) {
          // console.log(productList[i].goods)
          for (let j = 0; j < productList[i].goods.length; j++) {
              productList[i].goods[j].logo = `${res.data.data.domain}${productList[i].goods[j].logo}`
          }
      }
      // console.log(productList)
      that.productRow = productRow;
      that.imgUrls = imgUrls;
      that.productList = productList;
      that.$apply();
    });
  }

  watch = {
    pageTime(newValue, oldValue) {
      //   console.log(`num value: ${oldValue} -> ${newValue}`)
    }
  };

  onLoad() {
    let that = this;
    console.log("onLoad  index");
    wepy.login({
      success(res) {
        // console.log(res);
      }
    });
    comm.wxRequest({ query: {} }, api.Home, function(res) {
      console.log(res.data.data.time);
      let time = res.data.data.time * 1000;
      // let time = 10000;
      let _time = setInterval(() => {
        time -= 1000;
        if (time=='0') {
           clearInterval(_time);
           that.pageTime = "00:00:00";
           that.$apply();
        }else{
          that.pageTime = comm.dateformat(time);
          that.$apply();
        }
        //    console.log(that.pageTime)
      }, 1000);
    });
  }

  onShareAppMessage() {
    console.log("转发");
  }
}
</script>